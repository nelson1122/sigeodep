<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core">


    <ui:composition template="../templates/layoutTemplate.xhtml">
        <!--==================================================================-->
        <!--========================CABECERA SCRIPTS==========================-->                    
        <ui:define name="head">
            <link href="../../resources/css/style.css" rel="stylesheet" type="text/css" />               
            <script type="text/javascript">  
                function startA() {                                          
                    document.getElementById('IdForm1:IdAccordionPanel:IdPaint').click();                    
                    //$('#IdPaint').click();
                } 
                function startB() {                                          
                    document.getElementById('IdForm1:IdAccordionPanel:IdPaint2').click();                    
                    //$('#IdPaint').click();
                } 
                
                function exportChart() {  
                    $('#output').empty().append(chart.exportAsImage());  //export image  
                    dlg.show();//show the dialog  
                }                  
            </script> 
        </ui:define>
        <!--=================================================================-->
        <!--================================TITULOS==========================-->
        <ui:define name="titlePage">
            CRUCE DE VARIABLES
        </ui:define>
        <ui:define name="title">
            CRUCE DE VARIABLES
        </ui:define>
        <!--=================================================================-->
        <!--==============================CONTENIDO==========================-->
        <ui:define name="content">

            <p:growl id="message"  showDetail="true" sticky="true" autoUpdate="true" life="1000"  />
            <!--===================================================================================-->
            <br/>
            <p:panelGrid id="a" style="position: absolute;  width: 750px;  margin-left: -375px; left: 50%; " >                            
                <p:row>  
                    <p:column styleClass="ui-widget-header" style="text-align: center;">
                        <h:outputLabel value="OBSERVATORIO DEL DELITO - ALCALDA DE PASTO"/><br/>                              
                        <h:outputLabel value="CRUCE DE VARIABLES"/>                              
                    </p:column>                                       
                </p:row>
                <p:row >  
                    <p:column>
                        <h:form enctype="multipart/form-data" id="IdForm1"> 
                            <p:accordionPanel id="IdAccordionPanel" activeIndex="0" multiple="true" >
                                <!--======================== CRUCE DE VARIABLES ======================-->
                                <p:tab title="CRUCE DE VARIABLES">
                                    <p:pickList 
                                        id="reportPickList" value="#{crossMB.variables}" 
                                        var="variable" converter="variableConverter"
                                        itemLabel="#{variable.name}" itemValue="#{variable.id}" 
                                        showTargetControls="true" styleClass="ui-widget-content" />
                                    <br/>
                                    
                                    <p:commandButton 
                                        value="Realizar" 
                                        style="width: 100px;"
                                        id="cancel" 
                                        actionListener="#{crossMB.setRowAndColumns}"  
                                        update="@form"
                                        oncomplete="startB()" />                                                                               
                                    <h:outputLabel value="   "/>
                                    <p:commandButton 
                                        style="width: 100px;"
                                        value="Reiniciar" 
                                        actionListener="#{crossMB.reset}"
                                        update="@form"/>
                                    <p:commandButton
                                        id="IdPaint2"
                                        value="paint"
                                        update="@form"                                        
                                        ajax="false"
                                        style="display: none;">
                                    </p:commandButton>
                                    <p:commandButton
                                        id="IdPaint"
                                        value="paint"
                                        update="@form"                                        
                                        style="display: none;">
                                    </p:commandButton>
                                </p:tab>
                                <!--======================== TABLA DE RESULTADOS ======================-->
                                <p:tab title="TABLA DE RESULTADOS">
                                    <p:panelGrid >                                        
                                        <p:row rendered="#{crossMB.renderedDynamicDataTable}">
                                            <p:column colspan="2">
                                                <div style="width: 700px; overflow: scroll;">
                                                    <p:outputPanel                                            
                                                        id="IdDinamicTable2"  
                                                        binding="#{crossMB.dynamicDataTableGroup}"/>
                                                </div>
                                                <br/>
                                                <p:dataTable id="IdOutFile" style="display: none" >
                                                    <p:column>                                                  
                                                    </p:column>
                                                </p:dataTable> 
                                                <h:commandLink >  
                                                    <p:graphicImage value="../../resources/img/excel.png"/>
                                                    <p:dataExporter type="xls" target="IdOutFile" fileName="salidaXML" postProcessor="#{crossMB.postProcessXLS}"/>  
                                                </h:commandLink>
                                                <h:commandLink>  
                                                    <p:graphicImage value="../../resources/img/pdf.png" />  
                                                    <p:dataExporter type="pdf" target="IdOutFile" fileName="salidaPDF" preProcessor="#{crossMB.preProcessPDF}"/>  
                                                </h:commandLink>
                                            </p:column>
                                        </p:row>
                                    </p:panelGrid>
                                </p:tab>

                                <!--======================== GRAFICOS ======================-->
                                <p:tab title="GRAFICOS">
                                    <p:panelGrid>
                                        <p:row>
                                            <p:column >
                                                <p:panelGrid>
                                                    <p:row>
                                                        <p:column >
                                                            <h:outputLabel value="Tipo de grafico"/>  
                                                        </p:column>              
                                                        <p:column colspan="2">
                                                            <p:selectOneMenu 
                                                                id="IdGraphicalType" 
                                                                value="#{crossMB.graphicalType}"
                                                                style="width: 150px;">
                                                                <f:selectItem itemLabel="Lineal" itemValue="1" />  
                                                                <!--f:selectItem itemLabel="Pastel" itemValue="2" /-->
                                                                <f:selectItem itemLabel="Barras Vertical" itemValue="3" />
                                                                <f:selectItem itemLabel="Barras Horizontal" itemValue="4" />                                                        
                                                                <f:selectItem itemLabel="Barras Apilado" itemValue="5" />                                                        
                                                                <p:ajax                                                                     
                                                                    event="change"   
                                                                    oncomplete="startA()"
                                                                    listener="#{crossMB.changeGraphicalType}"/>
                                                            </p:selectOneMenu>
                                                        </p:column>       
                                                    </p:row>
                                                    <p:row >
                                                        <p:column >
                                                            <h:outputLabel value="Valor:"/>
                                                        </p:column>              
                                                        <p:column >
                                                            <h:outputLabel value="#{crossMB.variableName}"/>
                                                        </p:column>              
                                                        <p:column >
                                                            <p:selectOneMenu 
                                                                value="#{crossMB.currentValue}"
                                                                disabled="#{crossMB.valuesListDisabled}"
                                                                id="IdValues"
                                                                style="width: 150px;">
                                                                <f:selectItems value="#{crossMB.valuesList}"/>
                                                                <p:ajax                                                                     
                                                                    event="change"   
                                                                    oncomplete="startA()"
                                                                    listener="#{crossMB.changeGraphicalType}"/>
                                                            </p:selectOneMenu>
                                                        </p:column> 
                                                    </p:row>
                                                </p:panelGrid>        
                                            </p:column>                                                          
                                        </p:row>
                                        <p:row>
                                            <p:column>
                                                <!-- LINEAL -->
                                                <p:lineChart 
                                                    rendered="#{crossMB.renderedLineChart}"
                                                    id="linear" 
                                                    value="#{crossMB.lineModel}" 
                                                    legendPosition="ne"                                                                                        
                                                    xaxisAngle="270"
                                                    showMarkers="false"                                            
                                                    title="#{crossMB.lineModelTitle}" 
                                                    minY="0" 
                                                    maxY="#{crossMB.maxLineModelYaxis}" 
                                                    style="height:400px; width: 700px;margin-top:20px"                                
                                                    widgetVar="chart"
                                                    zoom="true"
                                                    animate="true"
                                                    />
                                                <!--p:commandButton type="button" value="Exportar" icon="ui-icon-extlink" onclick="exportChart();"/> 
                                                <p:dialog widgetVar="dlg" showEffect="fade" resizable="false" >  
                                                    <p:outputPanel id="output" layout="block"  />  
                                                </p:dialog--> 

                                                <!-- PASTEL -->
                                                <p:pieChart 
                                                    rendered="#{crossMB.renderedPieChart}"
                                                    id="pie" 
                                                    value="#{crossMB.pieModel}" 
                                                    legendPosition="w"                                            
                                                    style="height:400px; width: 700px; margin-top:20px"
                                                    title="#{crossMB.lineModelTitle}"
                                                    fill="false" showDataLabels="true"
                                                    />  
                                                <!-- BARRAS VERTICAL -->
                                                <p:barChart 
                                                    rendered="#{crossMB.renderedBarChartVertical}"
                                                    id="bar1" 
                                                    min="0"
                                                    max="#{crossMB.maxLineModelYaxis}" 
                                                    value="#{crossMB.lineModel}" 
                                                    legendPosition="ne"                                                                                        
                                                    title="#{crossMB.lineModelTitle}" 
                                                    style="height:400px; width: 700px; margin-top:20px"
                                                    zoom="true"
                                                    animate="true"/>
                                                <!-- BARRAS HORIZONTAL -->
                                                <p:barChart 
                                                    rendered="#{crossMB.renderedBarChartHorizontal}"
                                                    id="bar2" 
                                                    value="#{crossMB.lineModel}" 
                                                    legendPosition="ne"
                                                    orientation="horizontal"
                                                    max="#{crossMB.maxLineModelYaxis}" 
                                                    title="#{crossMB.lineModelTitle}" 
                                                    style="height:400px; width: 700px; margin-top:20px"
                                                    zoom="true"
                                                    animate="true"/>
                                                <!-- BARRAS APILADO -->
                                                <p:barChart 
                                                    rendered="#{crossMB.renderedBarChartStack}"
                                                    id="bar3" 
                                                    value="#{crossMB.lineModel}" 
                                                    legendPosition="ne" 
                                                    title="#{crossMB.lineModelTitle}" 
                                                    stacked="true"
                                                    max="#{crossMB.maxStackModelYaxis}" 
                                                    style="height:400px; width: 700px;margin-top:20px"
                                                    zoom="true"
                                                    animate="true"/>
                                            </p:column>
                                        </p:row>
                                    </p:panelGrid>                                        

                                </p:tab>

                            </p:accordionPanel>
                        </h:form>                        
                    </p:column>
                </p:row>
            </p:panelGrid>                
        </ui:define>
    </ui:composition>
</html>
